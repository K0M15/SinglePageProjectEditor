(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(l){if(l.ep)return;l.ep=!0;const n=t(l);fetch(l.href,n)}})();class c{constructor(e,t){this.editorElementId=e,this.type=t}toggleEditor(){console.error("Should be implemented by Class")}delete(){}async serialize(){throw Error("Object serialization should be implemented by child class")}static fromDataObject(e){throw Error("Object serialization should be implemented by child class")}}class p extends c{constructor(e){super(e,"TEXT"),this.pageElement=document.createElement("div"),this.pageElement.classList.add("editorText"),this.buttonContainer=document.createElement("div"),this.buttonContainer.classList.add("elem-btn-cont");let t=document.createElement("button");t.innerHTML="🗑️",t.onclick=()=>{this.delete()},this.buttonContainer.appendChild(t),this.pageElement.appendChild(this.buttonContainer),this.textareaElement=document.createElement("textarea"),this.pageElement.appendChild(this.textareaElement),this.pageElement.ondblclick=()=>{this.toggleEditor()},this.displayElement=document.createElement("div"),this.displayElement.classList.add("displayText"),this.pageElement.appendChild(this.displayElement),document.body.insertBefore(this.pageElement,document.getElementById("pageEnd"))}toggleEditor(){this.pageElement.classList.contains("editMode")?(this.pageElement.classList.remove("editMode"),this.render()):this.pageElement.classList.add("editMode")}render(){let e=this.textareaElement.value;this.displayElement.innerHTML=this.replaceMD(e)}replaceMD(e){return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(new RegExp("(?<!^)>","gm"),"&gt;"),e=e.replace(/^> (.*)$/gm,"<blockquote>$1</blockquote>"),e=e.replace(/```([\s\S]*?)```/g,(t,a)=>`<pre class="code-block"><code>${a}</code></pre>`),e=e.replace(/`([^`\n]+)`/g,"<code>$1</code>"),e=e.replace(/^###### (.*)$/gm,"<h6>$1</h6>"),e=e.replace(/^##### (.*)$/gm,"<h5>$1</h5>"),e=e.replace(/^#### (.*)$/gm,"<h4>$1</h4>"),e=e.replace(/^### (.*)$/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*)$/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*)$/gm,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/__(.*?)__/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/_(.*?)_/g,"<em>$1</em>"),e=e.replace(/^\d+\. (.*)$/gm,"<li>$1</li>"),e=e.replace(/(<li>.*<\/li>)/gms,"<ol>$1</ol>"),e=e.replace(/^[-+*] (.*)$/gm,"<li>$1</li>"),e=e.replace(/(<li>.*<\/li>)/gms,"<ul>$1</ul>"),e=e.replace(/^(?!<h|<ul>|<ol>|<li>|<blockquote>|<pre>|<p>|<code>)(.+)$/gm,"<p>$1</p>"),e}delete(){this.pageElement.remove(),super.delete()}async serialize(){return{panelType:this.type,data:this.textareaElement.value,id:this.editorElementId}}static fromDataObj(e){if(e.id===void 0||e.data===void 0)throw Error("obj corrupted");const t=new p(e.id);return t.textareaElement.value=e.data,t.render(),t}}class h extends c{constructor(e){super(e,"PICTURE"),this.pageElement=document.createElement("div"),this.pageElement.classList.add("editorPicture","editMode"),this.imageElement=document.createElement("img"),this.imageElement.src="",this.editorElement=document.createElement("div"),this.editorElement.classList.add("edit");let t=document.createElement("button"),a=document.createElement("label");this.fileSelectorElement=document.createElement("input"),t.innerText="Select Local",t.onclick=()=>{this.fileSelectorElement.click()},this.fileSelectorElement.type="file",this.fileSelectorElement.accept="image/*,.svg",this.fileSelectorElement.hidden=!0,a.classList.add("file-button"),a.appendChild(t),a.appendChild(this.fileSelectorElement),this.linkSelectorElement=document.createElement("input"),this.linkSelectorElement.type="text",this.linkSelectorElement.placeholder="Paste Webpath",this.editorElement.appendChild(a),this.editorElement.appendChild(this.linkSelectorElement);let l=document.createElement("button");l.onclick=()=>{this.toggleEditor()},l.innerText="Close",this.editorElement.appendChild(l),this.pageElement.appendChild(this.editorElement),this.pageElement.appendChild(this.imageElement),this.pageElement.ondblclick=()=>{this.toggleEditor()},document.body.insertBefore(this.pageElement,document.getElementById("pageEnd"))}toggleEditor(){if(this.pageElement.classList.contains("editMode")){if(this.pageElement.classList.remove("editMode"),this.linkSelectorElement.value)this.imageElement.src=this.linkSelectorElement.value;else if(this.fileSelectorElement.value&&this.fileSelectorElement.files!=null){const e=this.fileSelectorElement.files[0];if(!e)return;const t=new FileReader;t.onload=a=>{a.target!=null&&a.target.result!=null&&typeof a.target.result=="string"&&(this.imageElement.src=a.target.result)},t.readAsDataURL(e)}}else this.pageElement.classList.add("editMode")}delete(){this.pageElement.remove(),super.delete()}async saveLoadedImageData(){const e=await caches.open("spe-images"),t=await fetch(this.imageElement.src);if(!t.ok)throw Error(`Could not fetch image 			${this.editorElementId} from Source ${this.imageElement.src}			`);const a=await t.blob(),l=`http://synthetic.spe/${this.editorElementId}`;return await e.put(new Request(l),new Response(a,{headers:{"Content-Type":a.type}})),l}async serialize(){return{id:this.editorElementId,panelType:this.type,data:await this.saveLoadedImageData()}}static fromDataObj(e){if(e.id===void 0||e.data===void 0)throw Error("obj corrupted");const t=new h(e.id);return caches.open("spe-images").then(a=>a.match(e.data).then(l=>{if(l===void 0)throw Error(`No match for ${e.data} in cache "spe-images". Corrupted data?`);l.blob().then(n=>{t.imageElement.src=URL.createObjectURL(n),t.linkSelectorElement.value=t.imageElement.src})})),t.toggleEditor(),t}}class m extends c{constructor(e){super(e,"ACTION"),this.data=[["","Description","Responsible","Date"]],this.pageElement=document.createElement("div"),this.pageElement.classList.add("editorAction"),document.body.insertBefore(this.pageElement,document.getElementById("pageEnd")),this.render()}render(){let e=document.createElement("table"),t=document.createElement("tr");t.append(...this.data[0].map(i=>{let s=document.createElement("th");return s.innerText=i,s})),e.appendChild(t);let a=1;for(;a<this.data.length;){let i=document.createElement("tr");i.append(...this.data[a].map((s,o)=>this.handleFieldData(s,a,o))),e.appendChild(i),a++}let l=document.createElement("tr");l.classList.add("editorActionLastRow");let n=document.createElement("button");n.onclick=()=>{this.add_row()},n.innerText="Add",n.classList.add("new"),l.appendChild(n),e.appendChild(l),this.pageElement.replaceChildren(e)}add_row(){this.data.push([!1,null,null,null]),this.render()}handleFieldData(e,t,a){let l=document.createElement("td");const n=()=>{l.ondblclick=()=>{let i=document.createElement("input");i.onblur=s=>{this.data[t][a]=i.value,this.render()},l.replaceChildren(i),i.focus()}};if(a==0){let i=document.createElement("input");i.type="checkbox",i.onchange=()=>{console.log(i.checked),this.data[t][a]=i.checked},typeof e=="boolean"?i.checked=e:i.checked=!1,l.appendChild(i)}else if(typeof e=="string"&&!isNaN(Date.parse(e)))l.innerText=Date.parse(e).toLocaleString(),n();else if(typeof e=="string"&&e!="")l.innerText=e,n();else if(e===null||e==""){let i=document.createElement("input");i.onblur=s=>{this.data[t][a]=i.value,this.render()},l.appendChild(i)}return l}async serialize(){return{panelType:this.type,id:this.editorElementId,data:JSON.stringify(this.data)}}static fromDataObj(e){if(e.id===void 0||e.data===void 0)throw Error("obj corrupted");const t=new m(e.id);return t.data=JSON.parse(e.data),t.render(),t}}const g=[{cls:p,name:"Text",description:"A Markdown-Formated textfield"},{cls:h,name:"Picture",description:"A Picture from a link or from a file"},{cls:m,name:"Action",description:"An Element oranizing actions"}];function d(){const r=new Uint8Array(12);return crypto.getRandomValues(r),Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")}class f{constructor(){this.pageElements=[]}async serialize(){return await Promise.all(this.pageElements.map(e=>e.serialize()))}}class b{constructor(){this.state=new f,this.openedState={id:d(),name:void 0,ts:Date.now()},this.availableStates=[],this.loadAvailableStates()}loadAvailableStates(){try{const e=localStorage.getItem("spe-pages");if(e===null)return!1;this.availableStates.push(...JSON.parse(e))}catch{this.saveAvailableStates()}}saveAvailableStates(){localStorage.setItem("spe-pages",JSON.stringify(this.availableStates))}addPanel(e){this.state.pageElements.push(e)}removePanel(e){const t=this.state.pageElements.findIndex(a=>a.editorElementId===e);if(t==-1)throw Error(`Element with ID ${e} does not exist`);this.state.pageElements[t].delete(),this.state.pageElements.splice(t,1)}selectAvailableState(){}async loadState(e,t){const a=this.availableStates.find(s=>s.id==e);if(a===void 0)throw Error(`State with ID ${e} not available in localStorage`);this.openedState=a,this.openedState;const l=localStorage.getItem(e);if(l===null)throw Error(`Data for StateId ${e} was not available in localStorage`);const n=JSON.parse(l).pageData,i=n.length;for(let s=0;s<i;s++){let o=t.find(E=>E.name==n[s].panelType);if(o===void 0)throw Error(`Type ${n[s].panelType} not found in available panels. Maybe extension not loaded?`);const u=new o.cls(n[s].id);Object.assign(u,JSON.parse(n[s].data)),this.state.pageElements.push(u)}}async saveState(){this.saveAvailableStates(),this.state.serialize().then(e=>{this.openedState.id===void 0&&(this.openedState.id=d()),localStorage.setItem(this.openedState.id,JSON.stringify(e))})}}class y{constructor(){this.availablePanels=[],this.availablePanels.push(...g),this.stateHandler=new b,this.setupPage()}setupPage(){var l;const e=document.body;for(const n of this.availablePanels){let i=document.createElement("button");i.innerText=n.name,i.classList.add("btn-add-panel"),i.onclick=()=>{this.stateHandler.addPanel(new n.cls(d))},i.onmouseover=null,e.appendChild(i)}(l=e.firstElementChild)==null||l.classList.add("pageEnd"),e.appendChild(document.createElement("br"));let t=document.createElement("button");t.innerText="Save (Browser)",t.onclick=this.stateHandler.saveState;let a=document.createElement("button");a.innerText="Load (Browser)",a.onclick=this.stateHandler.selectAvailableState}addNewEditorElement(e){const t=this.availablePanels.find(a=>a.name==e);if(t===void 0)throw Error(`Type ${e} not found in available panels. Maybe extension not loaded?`);this.stateHandler.addPanel(new t.cls(d()))}loadEditorElement(e){const t=this.availablePanels.find(a=>a.name==e.panelType);if(t===void 0)throw Error(`Type ${e.panelType} not found in available panels. Maybe extension not loaded?`);this.stateHandler.addPanel(new t.cls(e.id))}loadExistingState(){}generateStaticSite(){throw Error("NOT IMPLEMENTED App.generateStaticSite")}}new y;
